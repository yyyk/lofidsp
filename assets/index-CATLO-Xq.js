(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function l(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=l(t);fetch(t.href,o)}})();function R(e,a){const l=(1<<a-1)-1;return Math.round(e*l)/l}function b(e,a){return Float32Array.from(e,l=>R(l,a))}function D(e,a){const l=new Float32Array(e.length);l[0]=e[0];for(let r=1;r<e.length;r++)l[r]=a*e[r]+(1-a)*l[r-1];return l}function $(e,a,l,r=!1){const t=a/l,o=r?D(e,.1):e,c=new Float32Array(Math.floor(o.length/t));for(let n=0;n<c.length;n++)c[n]=o[Math.floor(n*t)];return c}function B(e,a,l){const r=new ArrayBuffer(44+e.length*2),t=new DataView(r);function o(n,i){for(let s=0;s<i.length;s++)t.setUint8(n+s,i.charCodeAt(s))}o(0,"RIFF"),t.setUint32(4,36+e.length*2,!0),o(8,"WAVE"),o(12,"fmt "),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,l,!0),t.setUint32(24,a,!0),t.setUint32(28,a*l*2,!0),t.setUint16(32,l*2,!0),t.setUint16(34,16,!0),o(36,"data"),t.setUint32(40,e.length*2,!0);let c=44;for(let n=0;n<e.length;n++){const i=Math.max(-1,Math.min(1,e[n]));t.setInt16(c,i<0?i*32768:i*32767,!0),c+=2}return new Blob([r],{type:"audio/wav"})}function I(e,a,l){const r=new Float32Array(e.length),t=1/(2*Math.PI*l),o=1/a,c=o/(t+o);r[0]=e[0];for(let n=1;n<e.length;n++)r[n]=r[n-1]+c*(e[n]-r[n-1]);return r}function C(e,a){const l=Math.pow(2,a/12),r=Math.floor(e.length/l),t=new Float32Array(r);for(let o=0;o<r;o++){const c=o*l,n=Math.floor(c),i=Math.min(e.length-1,Math.ceil(c)),s=c-n;t[o]=(1-s)*e[n]+s*e[i]}return t}function L(e){if(e.numberOfChannels<2)return e;const a=e.length,l=e.sampleRate,r=e.getChannelData(0),t=e.getChannelData(1),o=new Float32Array(a);for(let n=0;n<a;n++)o[n]=(r[n]+t[n])/2;const c=new AudioContext().createBuffer(1,a,l);return c.copyToChannel(o,0),c}function x(e,a,l){const r=l/a,t=new Float32Array(Math.floor(e.length*r));for(let o=0;o<t.length;o++){const c=o/r,n=Math.floor(c),i=Math.min(e.length-1,Math.ceil(c)),s=c-n;t[o]=(1-s)*e[n]+s*e[i]}return t}const S=[{targetSampleRate:24e3,targetBitDepth:12,octave:0},{targetSampleRate:24e3,targetBitDepth:12,octave:1},{targetSampleRate:24e3,targetBitDepth:12,octave:2},{targetSampleRate:24e3,targetBitDepth:8,octave:0},{targetSampleRate:24e3,targetBitDepth:8,octave:1},{targetSampleRate:24e3,targetBitDepth:8,octave:2},{targetSampleRate:12e3,targetBitDepth:12,octave:0},{targetSampleRate:12e3,targetBitDepth:12,octave:1},{targetSampleRate:12e3,targetBitDepth:12,octave:2},{targetSampleRate:12e3,targetBitDepth:8,octave:0},{targetSampleRate:12e3,targetBitDepth:8,octave:1},{targetSampleRate:12e3,targetBitDepth:8,octave:2}];function A(e,a=24e3,l=12,r=1){e=L(e);const t=e.sampleRate,o=e.numberOfChannels,c=new Float32Array(e.length*o);for(let i=0;i<e.length;i++)for(let s=0;s<o;s++)c[i*o+s]=e.getChannelData(s)[i];let n=x(c,t,48e3);return n=C(n,12*r),n=$(n,48e3,a),n=b(n,l),n=I(n,a,a*2/3),n=C(n,-12*r),n=x(n,a,44100),[n,44100,o]}function M(e,a,l,r){return`${e.replace(/\.[^/.]+$/,"")}_${a}Hz_${l}bit_${r>0?r:"un"}pre-pitched.wav`}function F(e,a,l){var y;const{targetSampleRate:r,targetBitDepth:t,octave:o}=l,[c,n,i]=A(a,r,t,o),s=B(c,n,i),f=URL.createObjectURL(s),u=`${r}_${t}_${o}`;let d=document.getElementById(`section_${u}`);d||(d=document.createElement("div"),d.id=`section_${u}`,(y=document.getElementById("audio-container"))==null||y.appendChild(d));let p=document.getElementById(`title_${u}`);p||(p=document.createElement("p"),p.id=`title_${u}`,d.appendChild(p)),p.innerHTML=`${r}Hz / ${t}bit${o>0?`<br/><span class="small-text">${o} octave${o>1?"s":""} pre-pitched<span>`:""}`;let g=document.getElementById(`audio_${u}`);g||(g=document.createElement("audio"),g.id=`audio_${u}`,g.controls=!0,d.appendChild(g)),g.src=f;let m=document.getElementById(`button_${u}`);m&&d.removeChild(m),m=document.createElement("button"),m.id=`button_${u}`,m.innerText="download",m.addEventListener("click",()=>{const h=document.createElement("a");h.href=f,h.download=M(e,r,t,o),h.click()}),d.appendChild(m)}let E;async function U(e){const a=e.target.files[0];if(!a)return;const l=document.getElementById("input-container"),r=l.querySelector(".drag-text");r.textContent=`‚úÖ ${a.name} selected`,r.style.color="var(--mpc-red)";const t=document.getElementById("original-audio");t&&l.removeChild(t);const o=document.getElementById("audio-container");o.innerHTML="";const c=await a.arrayBuffer();E&&(E.close(),console.log("close audio context")),E=new window.AudioContext({sampleRate:44100});const n=await E.decodeAudioData(c),i=new OfflineAudioContext(n.numberOfChannels,n.length,n.sampleRate),s=i.createBufferSource();s.buffer=n;const f=i.createGain();f.gain.value=1,s.connect(f).connect(i.destination),s.start();const u=await i.startRendering();{const{numberOfChannels:d,sampleRate:p}=u,g=new Float32Array(u.length*d);for(let v=0;v<u.length;v++)for(let w=0;w<d;w++)g[v*d+w]=u.getChannelData(w)[v];const m=B(g,p,d),y=URL.createObjectURL(m);let h=document.getElementById("original-audio");h||(h=document.createElement("audio"),h.id="original-audio",h.controls=!0,l.appendChild(h)),h.src=y}S.forEach(d=>F(a.name,u,d))}function O(){const e=document.getElementById("input-container"),a=document.getElementById("fileInput");["dragenter","dragover","dragleave","drop"].forEach(c=>{e.addEventListener(c,l,!1),document.body.addEventListener(c,l,!1)}),["dragenter","dragover"].forEach(c=>{e.addEventListener(c,r,!1)}),["dragleave","drop"].forEach(c=>{e.addEventListener(c,t,!1)}),e.addEventListener("drop",o,!1);function l(c){c.preventDefault(),c.stopPropagation()}function r(){e.classList.add("drag-over")}function t(){e.classList.remove("drag-over")}function o(c){const n=c.dataTransfer;if(!n)return;const i=n.files;if(i.length>0){const s=i[0];if(s.type.startsWith("audio/")){const f=new DataTransfer;f.items.add(s),a.files=f.files;const u=new Event("change",{bubbles:!0});a.dispatchEvent(u);const d=e.querySelector(".drag-text");d.textContent=`‚úÖ ${s.name} selected`,d.style.color="var(--mpc-red)"}else{const f=e.querySelector(".drag-text");f.textContent="‚ùå Please select an audio file",f.style.color="var(--text-error)",setTimeout(()=>{f.textContent="üìÅ Select an audio file or drag & drop here",f.style.color="var(--text-secondary)"},3e3)}}}a.addEventListener("change",U)}O();
