(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();function b(e,a){const c=(1<<a-1)-1;return Math.round(e*c)/c}function x(e,a){return Float32Array.from(e,c=>b(c,a))}function D(e,a){const c=new Float32Array(e.length);c[0]=e[0];for(let r=1;r<e.length;r++)c[r]=a*e[r]+(1-a)*c[r-1];return c}function B(e,a,c,r=!1){const t=a/c,n=r?D(e,.1):e,l=new Float32Array(Math.floor(n.length/t));for(let o=0;o<l.length;o++)l[o]=n[Math.floor(o*t)];return l}function R(e,a,c){const r=new ArrayBuffer(44+e.length*2),t=new DataView(r);function n(o,s){for(let i=0;i<s.length;i++)t.setUint8(o+i,s.charCodeAt(i))}n(0,"RIFF"),t.setUint32(4,36+e.length*2,!0),n(8,"WAVE"),n(12,"fmt "),t.setUint32(16,16,!0),t.setUint16(20,1,!0),t.setUint16(22,c,!0),t.setUint32(24,a,!0),t.setUint32(28,a*c*2,!0),t.setUint16(32,c*2,!0),t.setUint16(34,16,!0),n(36,"data"),t.setUint32(40,e.length*2,!0);let l=44;for(let o=0;o<e.length;o++){const s=Math.max(-1,Math.min(1,e[o]));t.setInt16(l,s<0?s*32768:s*32767,!0),l+=2}return new Blob([r],{type:"audio/wav"})}function $(e,a,c){const r=new Float32Array(e.length),t=1/(2*Math.PI*c),n=1/a,l=n/(t+n);r[0]=e[0];for(let o=1;o<e.length;o++)r[o]=r[o-1]+l*(e[o]-r[o-1]);return r}function C(e,a){const c=Math.pow(2,a/12),r=Math.floor(e.length/c),t=new Float32Array(r);for(let n=0;n<r;n++){const l=n*c,o=Math.floor(l),s=Math.min(e.length-1,Math.ceil(l)),i=l-o;t[n]=(1-i)*e[o]+i*e[s]}return t}function I(e){if(e.numberOfChannels<2)return e;const a=e.length,c=e.sampleRate,r=e.getChannelData(0),t=e.getChannelData(1),n=new Float32Array(a);for(let o=0;o<a;o++)n[o]=(r[o]+t[o])/2;const l=new AudioContext().createBuffer(1,a,c);return l.copyToChannel(n,0),l}function L(e,a,c){const r=c/a,t=new Float32Array(Math.floor(e.length*r));for(let n=0;n<t.length;n++){const l=n/r,o=Math.floor(l),s=Math.min(e.length-1,Math.ceil(l)),i=l-o;t[n]=(1-i)*e[o]+i*e[s]}return t}const S=[{targetSampleRate:24e3,targetBitDepth:12,octave:0},{targetSampleRate:24e3,targetBitDepth:12,octave:1},{targetSampleRate:24e3,targetBitDepth:12,octave:2},{targetSampleRate:24e3,targetBitDepth:8,octave:0},{targetSampleRate:24e3,targetBitDepth:8,octave:1},{targetSampleRate:24e3,targetBitDepth:8,octave:2},{targetSampleRate:12e3,targetBitDepth:12,octave:0},{targetSampleRate:12e3,targetBitDepth:12,octave:1},{targetSampleRate:12e3,targetBitDepth:12,octave:2},{targetSampleRate:12e3,targetBitDepth:8,octave:0},{targetSampleRate:12e3,targetBitDepth:8,octave:1},{targetSampleRate:12e3,targetBitDepth:8,octave:2}];function A(e,a=24e3,c=12,r=1){console.log("original numberOfChannels",e.numberOfChannels),console.log("original sampleRate",e.sampleRate),e=I(e);const t=e.sampleRate,n=e.numberOfChannels;console.log("processed numberOfChannels",n),console.log("processed sampleRate",e.sampleRate);const l=new Float32Array(e.length*n);for(let s=0;s<e.length;s++)for(let i=0;i<n;i++)l[s*n+i]=e.getChannelData(i)[s];let o=C(l,12*r);return o=B(o,t,a),o=x(o,c),o=$(o,a,a*2/3),o=C(o,-12*r),o=L(o,a,t),[o,t,n]}function M(e,a,c,r){return`${e.replace(/\.[^/.]+$/,"")}_${a}Hz_${c}bit_${r>0?r:"un"}pre-pitched.wav`}function F(e,a,c){var y;const{targetSampleRate:r,targetBitDepth:t,octave:n}=c,[l,o,s]=A(a,r,t,n),i=R(l,o,s),g=URL.createObjectURL(i),u=`${r}_${t}_${n}`;let d=document.getElementById(`section_${u}`);d||(d=document.createElement("div"),d.id=`section_${u}`,(y=document.getElementById("audio-container"))==null||y.appendChild(d));let p=document.getElementById(`title_${u}`);p||(p=document.createElement("p"),p.id=`title_${u}`,d.appendChild(p)),p.innerHTML=`${r}Hz / ${t}bit${n>0?`<br/><span class="small-text">${n} octave${n>1?"s":""} pre-pitched<span>`:""}`;let f=document.getElementById(`audio_${u}`);f||(f=document.createElement("audio"),f.id=`audio_${u}`,f.controls=!0,d.appendChild(f)),f.src=g;let m=document.getElementById(`button_${u}`);m&&d.removeChild(m),m=document.createElement("button"),m.id=`button_${u}`,m.innerText="download",m.addEventListener("click",()=>{const h=document.createElement("a");h.href=g,h.download=M(e,r,t,n),h.click()}),d.appendChild(m)}let E;async function O(e){const a=e.target.files[0];if(!a)return;const c=document.getElementById("input-container"),r=c.querySelector(".drag-text");r.textContent=`‚úÖ ${a.name} selected`,r.style.color="var(--mpc-red)";const t=document.getElementById("original-audio");t&&c.removeChild(t);const n=document.getElementById("audio-container");n.innerHTML="",console.log(a);const l=await a.arrayBuffer();E&&(E.close(),console.log("close audio context")),E=new window.AudioContext({sampleRate:44100});const o=await E.decodeAudioData(l);console.log(o);const s=new OfflineAudioContext(o.numberOfChannels,o.length,o.sampleRate),i=s.createBufferSource();i.buffer=o;const g=s.createGain();g.gain.value=1,i.connect(g).connect(s.destination),i.start();const u=await s.startRendering();{const{numberOfChannels:d,sampleRate:p}=u,f=new Float32Array(u.length*d);for(let v=0;v<u.length;v++)for(let w=0;w<d;w++)f[v*d+w]=u.getChannelData(w)[v];const m=R(f,p,d),y=URL.createObjectURL(m);let h=document.getElementById("original-audio");h||(h=document.createElement("audio"),h.id="original-audio",h.controls=!0,c.appendChild(h)),h.src=y}S.forEach(d=>F(a.name,u,d))}function U(){const e=document.getElementById("input-container"),a=document.getElementById("fileInput");["dragenter","dragover","dragleave","drop"].forEach(l=>{e.addEventListener(l,c,!1),document.body.addEventListener(l,c,!1)}),["dragenter","dragover"].forEach(l=>{e.addEventListener(l,r,!1)}),["dragleave","drop"].forEach(l=>{e.addEventListener(l,t,!1)}),e.addEventListener("drop",n,!1);function c(l){l.preventDefault(),l.stopPropagation()}function r(){e.classList.add("drag-over")}function t(){e.classList.remove("drag-over")}function n(l){const o=l.dataTransfer;if(!o)return;const s=o.files;if(s.length>0){const i=s[0];if(i.type.startsWith("audio/")){const g=new DataTransfer;g.items.add(i),a.files=g.files;const u=new Event("change",{bubbles:!0});a.dispatchEvent(u);const d=e.querySelector(".drag-text");d.textContent=`‚úÖ ${i.name} selected`,d.style.color="var(--mpc-red)"}else{const g=e.querySelector(".drag-text");g.textContent="‚ùå Please select an audio file",g.style.color="var(--text-error)",setTimeout(()=>{g.textContent="üìÅ Select an audio file or drag & drop here",g.style.color="var(--text-secondary)"},3e3)}}}a.addEventListener("change",O)}U();
